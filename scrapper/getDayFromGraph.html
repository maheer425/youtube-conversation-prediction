<html>
  <head>
    <title>Test</title>
  </head>
</html>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <div id="line"></div>
  <div id="output"></div>
  <button id="findY"></button>
  <div id="yans">Find data at 100000 views</div>

<g id="graph">
   <rect x="81" y="30" width="507" height="120" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect>
   <g clip-path="url(#_ABSTRACT_RENDERER_ID_0)">
      <g>
         <rect x="81" y="149" width="507" height="1" stroke="none" stroke-width="0" fill="#f0f0f0"></rect>
         <rect x="81" y="109" width="507" height="1" stroke="none" stroke-width="0" fill="#f0f0f0"></rect>
         <rect x="81" y="70" width="507" height="1" stroke="none" stroke-width="0" fill="#f0f0f0"></rect>
         <rect x="81" y="30" width="507" height="1" stroke="none" stroke-width="0" fill="#f0f0f0"></rect>
      </g>
      <g>
         <rect x="81" y="149" width="507" height="1" stroke="none" stroke-width="0" fill="#e2e2e2"></rect>
      </g>
      <g>
         <path d="" stroke="#73c421" stroke-width="1" fill-opacity="1" fill="none"></path>
      </g>
   </g>
   <g></g>
   <g>
      <g>
         <text text-anchor="end" x="71" y="153" font-family="Arial" font-size="10" stroke="none" stroke-width="0" fill="#666666">0</text>
      </g>
      <g>
         <text text-anchor="end" x="71" y="113.33333333333334" font-family="Arial" font-size="10" stroke="none" stroke-width="0" fill="#666666">500,000</text>
      </g>
      <g>
         <text text-anchor="end" x="71" y="73.66666666666667" font-family="Arial" font-size="10" stroke="none" stroke-width="0" fill="#666666">1,000,000</text>
      </g>
      <g>
         <text text-anchor="end" x="71" y="34.000000000000014" font-family="Arial" font-size="10" stroke="none" stroke-width="0" fill="#666666">1,500,000</text>
      </g>
   </g>
</g>
</body>
<script>
  var test_path = "M67.5,122.84760606060607L68.70201920221716,108.88493939393939L69.90403840443433,102.11636363636364L71.10605760665149,98.49587878787878L72.30807680886865,96.06178787878787L73.51009601108582,93.28151515151515L74.71211521330298,90.0829393939394L75.91413441552014,87.96618181818181L77.11615361773731,86.80142424242425L78.31817281995447,85.74845454545454L79.52019202217163,84.70630303030303L80.7222112243888,83.37566666666666L81.92423042660596,82.47054545454546L83.12624962882312,81.61951515151515L84.27818469761456,79.70830303030303L85.48020389983174,78.60845454545455L86.6822231020489,77.74660606060606L87.88424230426605,77.14439393939394L89.08626150648323,76.68642424242424L90.28828070870038,76.21763636363636L91.49029991091754,75.81015151515152L92.69231911313472,74.5660606060606L93.89433831535187,73.78354545454545L95.09635751756903,73.2750909090909L96.2983767197862,72.82072727272727L97.50039592200336,72.41324242424243L98.70241512422052,71.90839393939393L99.9044343264377,71.43239393939393L101.10645352865485,71.11506060606061L102.30847273087201,70.86263636363637L103.51049193308918,70.64987878787879L104.71251113530634,70.32172727272727L105.9145303375235,69.95751515151515L107.11654953974067,69.56084848484848L108.31856874195783,69.13172727272728L109.52058794417499,68.23381818181818L110.72260714639216,67.4080303030303L111.92462634860932,66.76254545454546L113.12664555082648,66.14590909090909L114.32866475304365,65.66990909090909L115.53068395526081,65.09654545454545L116.73270315747797,64.42581818181819L117.93472235969514,63.91015151515151L119.1367415619123,63.55315151515151L120.33876076412946,63.17812121212121L121.54077996634663,62.81751515151515L122.74279916856379,62.53984848484848L123.94481837078095,62.31987878787879L125.14683757299812,62.07827272727273L126.34885677521528,61.508515151515155L127.55087597743244,60.93154545454546L128.7528951796496,60.5420909090909L129.95491438186679,60.17787878787878L131.15693358408393,59.8749696969697L132.3589527863011,59.377333333333326L133.56097198851825,59.03115151515151L134.76299119073542,58.56236363636363L135.9650103929526,58.21618181818182L137.16702959516977,57.94212121212121L138.3690487973869,57.69690909090909L139.57106799960408,57.45530303030303L140.77308720182123,57.22090909090909L141.9751064040384,56.97569696969697L143.17712560625557,56.77736363636363L144.37914480847274,56.55739393939393L145.5811640106899,56.40593939393939L146.78318321290706,56.26530303030303L147.9852024151242,56.092212121212114L149.18722161734138,55.89748484848485L150.38924081955855,55.67030303030303L151.59126002177572,55.52966666666667L152.79327922399287,55.20512121212121L153.99529842621004,54.92745454545454L155.1973176284272,54.71109090909091L156.39933683064436,54.538L157.60135603286153,54.372121212121215L158.8033752350787,54.19542424242424L160.00539443729585,54.04036363636364L161.20741363951302,53.76269696969696L162.40943284173017,53.647303030303036L163.61145204394734,53.4850303030303L164.8134712461645,53.3660303030303L166.01549044838168,53.20375757575758L167.21750965059883,53.08115151515152L168.419528852816,52.99821212121212L169.62154805503314,52.83233333333334L170.82356725725032,52.72415151515152L172.0255864594675,52.55466666666666L173.22760566168466,52.41763636363636L174.4296248639018,52.26257575757576L175.63164406611895,52.13636363636364L176.83366326833612,51.9380303030303L178.0356824705533,51.718060606060604L179.23770167277047,51.490878787878785L180.43972087498764,51.267303030303026L181.6417400772048,51.097818181818184L182.84375927942193,50.867030303030305L184.0457784816391,50.70115151515151L185.24779768385628,50.394636363636366L186.44981688607345,50.21072727272727L187.65183608829062,49.92584848484849L188.85385529050777,49.75996969696969L190.0558744927249,49.60490909090909L191.25789369494208,49.41739393939393L192.45991289715926,49.22266666666667L193.66193209937643,49.10006060606061L194.8639513015936,48.96663636363637L196.06597050381075,48.85845454545455L197.26798970602792,48.75027272727273L198.47000890824506,48.64569696969697L199.67202811046224,48.53030303030303L200.8740473126794,48.39687878787879L202.07606651489655,48.30672727272727L203.27808571711373,48.223787878787874L204.4801049193309,48.07954545454545L205.68212412154804,47.94972727272727L206.88414332376522,47.81630303030303L208.0861625259824,47.70451515151515L209.28818172819953,47.592727272727274L210.4902009304167,47.46651515151515L211.69222013263388,47.343909090909094L212.89423933485102,47.235727272727274L214.0962585370682,47.105909090909094L215.29827773928537,46.994121212121215L216.5002969415025,46.922L217.70231614371968,46.81381818181818L218.90433534593686,46.73087878787878L220.106354548154,46.629909090909095L221.30837375037117,46.510909090909095L222.51039295258835,46.37387878787878L223.7124121548055,46.29815151515152L224.91443135702266,46.21160606060606L226.11645055923984,46.13227272727272L227.31846976145698,46.0240909090909L228.52048896367415,45.91230303030302L229.72250816589133,45.80772727272728L230.92452736810847,45.68512121212122L232.12654657032564,45.5769393939394L233.32856577254282,45.50121212121212L234.53058497475996,45.41827272727272L235.73260417697713,45.3100909090909L236.9346233791943,45.21633333333334L238.13664258141145,45.09733333333334L239.33866178362862,45.02881818181818L240.5406809858458,44.94948484848484L241.74270018806294,44.9170303030303L242.9447193902801,44.88457575757576L244.1467385924973,44.82327272727272L245.34875779471443,44.74754545454546L246.5507769969316,44.67181818181818L247.75279619914878,44.606909090909085L248.95481540136592,44.509545454545446L250.1568346035831,44.43381818181818L251.35885380580027,44.368909090909085L252.5608730080174,44.29678787878788L253.76289221023458,44.239090909090905L254.96491141245176,44.18139393939394L256.1669306146689,44.130909090909086L257.3689498168861,44.091242424242424L258.57096901910325,44.066L259.77298822132036,43.997484848484845L260.9750074235376,43.9289696969697L262.1770266257547,43.853242424242424L263.3790458279719,43.770303030303026L264.58106503018905,43.69818181818182L265.7830842324062,43.611636363636364L266.9851034346234,43.56115151515151L268.1871226368405,43.514272727272726L269.38914183905774,43.46739393939394L270.59116104127486,43.42412121212121L271.79318024349203,43.355606060606064L272.9951994457092,43.276272727272726L274.1972186479263,43.20415151515151L275.39923785014355,43.16448484848485L276.60125705236067,43.121212121212125L277.80327625457784,43.04548484848485L279.005295456795,43.009424242424245L280.2073146590122,42.96254545454545L281.40933386122936,42.86518181818181L282.6113530634465,42.74978787878787L283.8133722656637,42.71012121212121L285.0153914678808,42.62718181818181L286.217410670098,42.58390909090909L287.41942987231516,42.47933333333333L288.6214490745323,42.43606060606061L289.8234682767495,42.39278787878787L291.0254874789666,42.36754545454545L292.2275066811838,42.30263636363637L293.42952588340097,42.20887878787879L294.63154508561814,42.15478787878787L295.8335642878353,42.10430303030303L297.03558349005243,42.06824242424243L298.23760269226966,42.03218181818181L299.4396218944868,41.97087878787879L300.64164109670395,41.92399999999999L301.8436602989211,41.86630303030303L303.04567950113824,41.80499999999999L304.24769870335547,41.76533333333333L305.4497179055726,41.72927272727273L306.65173710778976,41.69681818181817L307.85375631000693,41.64272727272727L309.0557755122241,41.61387878787879L310.2577947144413,41.57060606060605L311.4598139166584,41.53093939393939L312.6618331188756,41.48406060606061L313.86385232109274,41.41915151515151L315.0658715233099,41.37227272727273L316.2678907255271,41.336212121212114L317.4699099277442,41.25687878787879L318.6719291299614,41.19918181818181L319.87394833217854,41.14509090909091L321.0759675343957,41.11624242424243L322.2779867366129,41.090999999999994L323.48000593883,41.083787878787874L324.68202514104723,41.05493939393939L325.88404434326435,41.01166666666667L327.0860635454815,40.979212121212115L328.2880827476987,40.961181818181814L329.49010194991587,40.93233333333333L330.69212115213304,40.90709090909091L331.8941403543502,40.88184848484849L333.09615955656733,40.849393939393934L334.2981787587845,40.82054545454545L335.5001979610017,40.79169696969697L336.70221716321885,40.755636363636356L337.904236365436,40.726787878787874L339.1062555676532,40.712363636363634L340.3082747698703,40.68351515151515L341.5102939720875,40.66187878787879L342.71231317430465,40.604181818181814L343.9143323765218,40.57533333333333L345.116351578739,40.54287878787879L346.3183707809562,40.52484848484848L347.5203899831733,40.470757575757574L348.72240918539046,40.44551515151515L349.92442838760763,40.43469696969697L351.1264475898248,40.366181818181815L352.328466792042,40.32651515151515L353.53048599425915,40.28324242424242L354.73250519647627,40.247181818181815L355.93452439869344,40.21112121212121L357.1365436009106,40.15342424242424L358.3385628031278,40.117363636363635L359.54058200534496,40.0560606060606L360.74260120756213,39.991151515151515L361.94462040977925,39.95509090909091L363.1466396119964,39.90821212121212L364.3486588142136,39.861333333333334L365.55067801643077,39.81445454545454L366.75269721864794,39.767575757575756L367.9547164208651,39.68824242424242L369.1567356230822,39.608909090909094L370.40883895872514,39.58366666666666L371.6108581609423,39.497121212121215L372.81287736315943,39.43221212121212L374.0148965653766,39.399757575757576L375.2169157675938,39.33845454545454L376.41893496981095,39.244696969696975L377.6209541720281,39.1689696969697L378.8229733742453,39.11848484848484L380.0249925764624,39.05718181818182L381.2270117786796,38.9850606060606L382.42903098089675,38.91654545454546L383.6310501831139,38.85524242424242L384.8330693853311,38.779515151515156L386.0350885875483,38.69657575757576L387.2371077897654,38.6460909090909L388.43912699198256,38.57036363636364L389.64114619419973,38.49824242424242L390.8431653964169,38.4369393939394L392.0451845986341,38.3900606060606L393.24720380085125,38.31072727272728L394.44922300306837,38.2169696969697L395.65124220528554,38.14484848484848L396.8532614075027,38.07272727272728L398.0552806097199,38.0150303030303L399.25729981193706,37.96454545454546L400.45931901415423,37.90324242424242L401.66133821637135,37.8419393939394L402.8633574185885,37.80227272727272L404.0653766208057,37.73015151515152L405.26739582302287,37.6760606060606L406.46941502524004,37.62557575757576L407.6714342274572,37.56427272727272L408.8734534296743,37.477727272727265L410.0754726318915,37.37315151515152L411.2774918341087,37.31184848484848L412.47951103632585,37.283L413.681530238543,37.225303030303024L414.8835494407602,37.18924242424242L416.0855686429773,37.109909090909085L417.2875878451945,37.07384848484848L418.48960704741165,37.03418181818182L419.6916262496288,37.001727272727265L420.893645451846,36.965666666666664L422.09566465406317,36.93681818181818L423.2976838562803,36.879121212121206L424.49970305849746,36.82863636363636L425.70172226071463,36.79978787878788L426.9037414629318,36.745696969696965L428.105760665149,36.70242424242424L429.30777986736615,36.641121212121206L430.50979906958327,36.605060606060604L431.71181827180044,36.57981818181818L432.9138374740176,36.53654545454545L434.1158566762348,36.489666666666665L435.31787587845196,36.46081818181818L436.51989508066913,36.41754545454545L437.72191428288625,36.374272727272725L438.9239334851034,36.32378787878788L440.1259526873206,36.29854545454545L441.32797188953776,36.255272727272725L442.52999109175494,36.212L443.7320102939721,36.19036363636363L444.9340294961892,36.147090909090906L446.1360486984064,36.114636363636365L447.33806790062357,36.093L448.54008710284074,36.05333333333333L449.7421063050579,36.028090909090906L450.94412550727503,35.974000000000004L452.1461447094922,35.95596969696969L453.3481639117094,35.92351515151515L454.55018311392655,35.883848484848485L455.7522023161437,35.851393939393944L456.9542215183609,35.83336363636363L458.156240720578,35.79369696969697L459.3582599227952,35.728787878787884L460.56027912501236,35.70715151515151L461.76229832722953,35.67830303030303L462.9643175294467,35.60978787878787L464.1663367316639,35.55930303030303L465.368355933881,35.53766666666667L466.57037513609816,35.494393939393944L467.77239433831534,35.42948484848485L468.9744135405325,35.36818181818181L470.1764327427497,35.32130303030303L471.37845194496686,35.29966666666667L472.58047114718397,35.25278787878787L473.78249034940114,35.20590909090909L474.9845095516183,35.148212121212126L476.1865287538355,35.06887878787879L477.38854795605266,34.99315151515151L478.59056715826983,34.94266666666667L479.79258636048695,34.86333333333333L480.9946055627041,34.80563636363637L482.1966247649213,34.75515151515151L483.39864396713847,34.70827272727273L484.60066316935564,34.66139393939393L485.8026823715728,34.56403030303031L487.00470157378993,34.49912121212121L488.2067207760071,34.45945454545455L489.4087399782243,34.41618181818181L490.61075918044145,34.36569696969697L491.8127783826586,34.30078787878787L493.0147975848758,34.23948484848485L494.2168167870929,34.14572727272727L495.4188359893101,34.07721212121211L496.62085519152726,33.99066666666667L497.8228743937444,33.89330303030303L499.0248935959616,33.87887878787879L500.2269127981788,33.82478787878787L501.4289320003959,33.74545454545455L502.63095120261306,33.68775757575757L503.83297040483023,33.64448484848485L505.0349896070474,33.612030303030295L506.2370088092646,33.56515151515151L507.43902801148175,33.50384848484849L508.64104721369887,33.45696969696969L509.84306641591604,33.42090909090909L511.0450856181332,33.39927272727273L512.2471048203504,33.363212121212115L513.4491240225675,33.31633333333333L514.6511432247847,33.29109090909091L515.8531624270018,33.236999999999995L517.0551816292191,33.218969696969694L518.2572008314362,33.17930303030303L519.4592200336533,33.146848484848476L520.6612392358705,33.117999999999995L521.813174304662,33.07472727272727L523.0151935068791,33.03145454545454L524.2172127090963,32.991787878787875L525.4192319113135,32.95933333333333L526.6212511135307,32.94130303030303L527.8232703157478,32.883606060606056L529.0252895179649,32.83312121212121L530.2273087201821,32.732151515151514L531.4293279223994,32.69248484848485L532.6313471246165,32.634787878787876L533.8333663268336,32.613151515151515L535.0353855290507,32.55184848484848L536.2374047312679,32.479727272727274L537.4394239334852,32.389575757575756L538.6414431357023,32.349909090909094L539.8434623379194,32.31024242424242L541.0454815401365,32.248939393939395L542.2475007423537,32.19124242424242L543.449519944571,32.147969696969696L544.6515391467881,32.104696969696974L545.8535583490052,32.03978787878788L547.0555775512224,31.95684848484848L548.2575967534395,31.913575757575757L549.4596159556568,31.85948484848484L550.6616351578739,31.805393939393937L551.863654360091,31.747696969696975L553.0656735623082,31.71524242424242L554.2676927645255,31.668363636363637L555.4697119667426,31.635909090909095L556.6717311689597,31.556575757575757L557.8737503711768,31.47363636363636L559.075769573394,31.39069696969696L560.2777887756113,31.333L561.4798079778284,31.282515151515156L562.6818271800455,31.21039393939394L563.8838463822626,31.15269696969696L565.0858655844798,31.12384848484848L566.2878847866971,31.08418181818182L567.4899039889142,31.048121212121217L568.6919231911313,30.9940303030303L569.8939423933484,30.96518181818182L571.0959615955657,30.90748484848484L572.2979807977829,30.86060606060606L573.5,30.83536363636364"
  //Getting stats elements from youtube page
  $("#action-panel-overflow-button").click();
  $("button[data-trigger-for='action-panel-stats']").click();
  //Todo: Check if stats are avialable
  var $graph = $("svg[aria-label='A chart.'] g");
  var $rect = $('rect', $graph);
  var height = $rect.attr('height');
  var width = $rect.attr('width');
  var my_path = $('path', $graph).attr('d');
  var max_y = 0;
  $('g text', $graph).each(function(){
    cur_y = parseFloat(this.textContent.replace(',',''));
    max_y = Math.max(max_y, cur_y);
  })
  my_path = test_path;
 
  var svg = d3.select("#line").append("svg");
  var path = 
      svg.append("path")
        .attr("d", my_path)
        .attr("fill", "none")
        .attr("stroke", "black");

  var pathEL = path.node();

    // var my_path = document.querySelector("svg[aria-label='A chart.'] g path").getAttribute('d');


  function getX(pathEl, target){
    var segs = pathEl.pathSegList;
    var prev_point = segs.getItem(0);
    for (var i=1; i<segs.length; i++)
      console.log(segs.getItem(i).y * (33000/150))
      if (point.y > target)
        return (prev_point.x+point.x)/2;
    }
    console.log("Could not find point in graph")
    return undefined;
  }

  function xToDate(x_cord){
    curDate = new Date(); //assuming retrieved today
    startDate = new Date(); //TODO: change this to start data (via api?)
    max_x = (curData-first)/(1000*60*60*24); //difference of days
    min_x = 0;
    range = width; //svg width
    var proportion = x_cord/range;
    var daysFromStart = proportion * max_x;
    var msToAdd = daysFromStart * 24 * 60 * 60 * 1000; 
    resDate = new Data(startDate + msToAdd);
  }

  function findDate(target_views){
    //Calculate Target
    //var max_y = 600000; // I calculate this as a global
    var min_y = 0;
    var range = height;//svg height
    var proportion = target_views/(max_y-min_y);
    var target = range - (proportion * range);
    //Search for target
    x = getX(pathEL, target);
    return xToDate(x);
  }

  $("#findY").click(function(){
      y = findDate(100000);
      ans = y;
      $("#yans").text(ans);
  });
</script>
